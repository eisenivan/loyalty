/*
 *  Loyalty.js - v0.1.0
 *  Dynamic content based on page views
 *  
 *
 *  Made by Ivan Eisenberg
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=b,this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="loyalty",d={antiflickercss:"true",delay:30,debug:"false",runbefore:null,runafter:null};a.extend(b.prototype,{init:function(){var b=this.settings.runbefore,c=this.settings.runafter;"true"===this.settings.antiflickercss?(a("head").append('<!-- Added by LOYALTYJS --><style type="text/css">*[data-loyalty]{display: none;}</style>'),"true"===this.settings.debug&&console.log("Loyalty: Added anti-flicker css to HEAD tag.")):"true"===this.settings.debug&&console.log("Loyalty: Did not add anti-flicker css to HEAD tag."),"function"==typeof b&&("true"===this.settings.debug&&console.log("Loyalty: Running runbefore function."),b()),this.trackViews(this.settings.delay,function(){"function"==typeof c&&("true"===this.settings.debug&&console.log("Loyalty: Running runafter function."),c())})},trackViews:function(a,b){var c=6e4*a;if(void 0!==Storage){var d=0;localStorage.getItem("loyalty_views")&&(d=parseInt(localStorage.getItem("loyalty_views")));var e=d+1,f=(new Date).getTime()/c;if(localStorage.getItem("loyalty_timestamp")){var g=localStorage.getItem("loyalty_timestamp");"true"===this.settings.debug&&console.log("Loyalty: If "+(f-g)+" is > than "+this.settings.delay+" this will count as a new loyalty page view."),f-g>this.settings.delay&&this.bumpCount(e,f)}else this.bumpCount(e,f)}this.domRender(),"function"==typeof b&&b()},bumpCount:function(a,b){"true"===this.settings.debug&&console.log("Loyalty: Counting as a new session"),localStorage.setItem("loyalty_views",a),localStorage.setItem("loyalty_timestamp",b),this.domRender()},domRender:function(){var b=0;localStorage.getItem("loyalty_views")&&(b=parseInt(localStorage.getItem("loyalty_views"))),a("html").attr("data-loyaltyViews",b),a("*[data-loyalty]").each(function(){$this=a(this);var c=$this.attr("data-loyalty-min"),d=$this.attr("data-loyalty-max");if("undefined"==typeof c&&"undefined"==typeof d||""===c&&""===d){var e=parseInt($this.attr("data-loyalty"));b===e?$this.show():$this.hide()}else("undefined"==typeof c||""===c)&&(c=0),("undefined"==typeof d||""===d)&&(d=99999999),b>=c&&d>=b?$this.show():$this.hide();a("*[data-loyalty-count]").each(function(){a(this).text(b)})})}}),a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))}),this}}(jQuery,window,document);